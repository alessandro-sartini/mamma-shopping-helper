<div class="liste-container">
  <!-- Header + Bottone -->
  <div class="liste-header">
    <h2>Le Tue Liste della Spesa</h2>
    <button class="btn-new" routerLink="/lista/new">+ Nuova Lista</button>
  </div>

  <!-- Loading -->
  @if (loading) {
  <div class="loading">
    <p>â³ Caricamento liste...</p>
  </div>
  }

  <!-- Errore -->
  @if (error) {
  <div class="error-box">
    <p>âŒ {{ error }}</p>
    <button (click)="loadListe()">Riprova</button>
  </div>
  }

  <!-- Liste -->
  @if (!loading && !error) {

  <!-- No lista -->
  @if (liste.length === 0) {
  <div class="empty-state">
    <p>ğŸ“ Non hai ancora liste della spesa</p>
    <button class="btn-primary" routerLink="/lista/new">Crea la Prima Lista</button>
  </div>
  }

  <!-- Liste -->
  @if (liste.length > 0) {
  <div class="liste-grid">
    @for (lista of liste; track lista.id) {
    <div class="lista-card" [routerLink]="['/lista', lista.id]">
      <!-- Header Card -->
      <div class="card-header">
        <h3>{{ lista.titolo }}</h3>
        @if (lista.conclusa) {
        <span class="badge-conclusa">âœ“ CONCLUSA</span>
        }
      </div>

      <!-- Descrizione -->
      @if (lista.descrizione) {
      <p class="card-description">{{ lista.descrizione }}</p>
      }

      <!-- Progress-->
      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getProgressPercent(lista)"></div>
        </div>
        <span class="progress-text">
          {{ getProdottiAcquistati(lista) }} / {{ lista.prodotti.length }} prodotti
        </span>
      </div>


      <div class="card-info">
        <span class="card-date">ğŸ“… Creata: {{ lista.dataCreazione | date : 'dd/MM/yyyy HH:mm' }}</span>
        <span class="card-date">ğŸ”„ Modificata: {{ lista.dataUltimaModifica | date : 'dd/MM/yyyy HH:mm' }}</span>
        <span class="card-user">ğŸ‘¤ Creata da: <strong>{{ lista.creataDa }}</strong></span>
      </div>

      <!-- Actions -->
      <div class="card-actions">
        <button class="btn-edit" (click)="editLista(lista.id, $event)">âœï¸ Modifica</button>
        <button
          class="btn-toggle"
          (click)="toggleConclusa(lista.id, $event)"
          [class.active]="lista.conclusa"
        >
          @if (lista.conclusa) { ğŸ”“ Riapri } @else { âœ“ Completa }
        </button>
        <button class="btn-delete" (click)="deleteLista(lista.id, $event)">ğŸ—‘ï¸ Elimina</button>
      </div>
    </div>
    }
  </div>
  } }
</div>
